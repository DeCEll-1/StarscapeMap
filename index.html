<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./css/LayoutCSS.css" asp-append-version="true" />
    <link rel="stylesheet" href="./css/MapCSS.css" />

    <meta content="Starscape Web Map" property="og:title" /> <!-- embed title -->
    <meta content="Brought to you by NBI" property="og:description" /> <!-- description -->
    <meta content="https://decell-1.github.io/StarscapeMap" property="og:url" />
    <!-- embed click link -->

    <meta property="og:image" content="https://decell-1.github.io/StarscapeMap/Resources/NBIImages/Example.png">
    <!-- embed image -->

    <meta content="#472C6D" data-react-helmet="true" name="theme-color" /> <!-- embed color -->
    <meta name="twitter:card" content="summary_large_image"> <!-- make the embed larger -->

    <link rel="apple-touch-icon" sizes="57x57" href="Resources/Favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="Resources/Favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="Resources/Favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="Resources/Favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="Resources/Favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="Resources/Favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="Resources/Favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="Resources/Favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="Resources/Favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="Resources/Favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="Resources/Favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="Resources/Favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="Resources/Favicons/favicon-16x16.png">
    <link rel="manifest" href="Resources/Favicons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>NBI</title>
    <script type="importmap">
        {
            "imports": {
                "three": "./three/build/three.module.js",
                "three/addons/": "./three/examples/jsm/",
                "troika-three-text": "./lib/troika-three-text.esm.js",
                "troika-worker-utils": "./lib/troika-worker-utils.esm.js",
                "troika-three-utils": "./lib/troika-three-utils.js",
                "bidi-js": "./lib/bidi.min.js",
                "webgl-sdf-generator": "./lib/webgl-sdf-generator.min.js"
            }
        }
    </script>
    <!-- 
    * * licenses:
    three - MIT - https://github.com/mrdoob/three.js/blob/dev/LICENSE
    bootstrap - MIT - https://github.com/twbs/bootstrap/blob/main/LICENSE
    troika three text, troika worker utils, troika three utils - MIT - https://github.com/protectwise/troika/blob/main/LICENSE
    bidi js - MIT - https://github.com/lojjic/bidi-js/blob/main/LICENSE.txt
    webgl sdf generator - MIT - https://github.com/lojjic/webgl-sdf-generator/blob/main/LICENSE.txt
    -->

</head>

<body>


    <header>
        <nav id="intro" class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light border-bottom box-shadow mb-3">
            <div class="logo-wrapper d-flex justify-content-center align-items-center flex-grow-1">
                <div id="intro-nbi-logo" class="nav-item">
                    <img src="Resources/NBIImages/nbi.png" alt="nbi" class="img-fluid">
                </div>

                <div id="center-logo" class="nav-item" style="visibility: hidden;">
                    <img id="center-logo-img" src="Resources/NBIImages/nbi.png" alt="nbi">
                </div>
            </div>

            <div class="container-fluid" style="position: absolute;">
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">

                    <ul class="navbar-nav flex-grow-1 intro-element">
                        <li class="nav-item">
                            <div class="nav-link text-light">Brought to you by NBI.</div>
                        </li>
                        <li class="nav-item ms-auto">
                            <a id="joinNBI" class="nav-link text-light btn" href="https://discord.gg/qgEqWtgNRb"
                                target="_blank">Join The
                                Development Server Here!</a>
                        </li>
                        <li class="nav-item ms-auto me-5">
                            <style>
                                #joinNBI:hover {
                                    outline: solid;
                                    outline-color: #9b59b6;

                                }
                            </style>
                            <a id="joinNBI" class="nav-link text-light btn"
                                href="https://decell-1.github.io/Nebula-Industries-Propoganda/" target="_blank">Join NBI
                                Here!</a>
                        </li>
                    </ul>

                </div>
            </div>
        </nav>
    </header>

    <div id="content-cover"></div>

    <div style="padding-top: 50px; height: calc(100vh);" class="w-100 d-flex">
        <div class="w-100 flex-fill intro-element">

            <div id="mapCanvas" class="w-100 h-100" style="height:100vh; position:relative;">
                <div class="position-absolute canvas-ignore" style="width:22%">
                    <div class="position-absolute" style="width:49%">
                        <div class="map-menu-container input-group-sm" style="" data-title="Search">
                            <input type="text" class="form-control map-menu-input-text" autocomplete="off"
                                placeholder="System name" aria-label="System name" id="TBSystemSearch">

                            <div id="loadingStatus" style="visibility: hidden; height: 0;">
                                <label id="loadingText" for="loadingAnimation"></label>
                                <div id="loadingAnimation" class="spinner-border text-secondary spinner-border-sm"
                                    role="status">
                                </div>
                            </div>
                        </div>

                        <div class="map-menu-container input-group-sm mt-2" style="" data-title="Star Coloring">

                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="radio" name="StarColoring"
                                    id="RadioButtonSecurity" value="RadioButtonSecurity">
                                <label class="form-check-label text-light" for="RadioButtonSecurity">Security</label>
                            </div>

                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="radio" name="StarColoring"
                                    id="RadioButtonSpectral" value="RadioButtonSpectral">
                                <label class="form-check-label text-light" for="RadioButtonSpectral">Spectral</label>
                            </div>

                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="radio" name="StarColoring"
                                    id="RadioButtonSpice" value="RadioButtonSpice">
                                <label class="form-check-label text-light" for="RadioButtonSpice">Spice</label>
                            </div>

                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="radio" name="StarColoring"
                                    id="RadioButtonFaction" value="RadioButtonFaction">
                                <label class="form-check-label text-light" for="RadioButtonFaction">Faction</label>
                            </div>
                        </div>

                        <div class="map-menu-container input-group-sm mt-2" style="" data-title="Map Layers">
                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="checkbox" id="CBSystems"
                                    value="CBSystems" checked>

                                <label class="form-check-label text-light" for="CBSystems">
                                    Systems
                                </label>
                            </div>

                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="checkbox" id="CBLinks"
                                    value="CBLinks" checked>

                                <label class="form-check-label text-light" for="CBLinks">Links</label>
                            </div>

                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="checkbox" id="CBSystemNames"
                                    value="CBSystemNames" checked>

                                <label class="form-check-label text-light" for="CBSystemNames">
                                    System Names
                                </label>
                            </div>

                            <div class="form-check form-check-inline text-center">
                                <input class="form-check-input form-control" type="checkbox" id="CBFactionBorders"
                                    value="CBFactionBorders" checked>

                                <label class="form-check-label text-light" for="CBFactionBorders">
                                    Faction Borders
                                </label>
                            </div>

                        </div>

                        <div id="statsContainer" class="map-menu-container input-group-sm mt-2" style=""
                            data-title="Stats">
                        </div>

                    </div>

                    <div id="searchResultsContainer" class="map-menu-container input-group-sm float-end"
                        style="width: 49%; visibility: hidden; height: 0px; padding: 0;" data-title="Search Results">
                        <div>
                            <div class="float-end" style="height: auto; margin-top: -35px;">
                                <label onclick="clearValue('TBSystemSearch')">X</label>
                            </div>
                        </div>
                        <ul class="ps-3 mb-0" id="searchResults">
                        </ul>
                    </div>

                </div>

                <div id="selectionView" class="position-absolute row w-100 canvas-ignore" style="pointer-events: none;">
                    <div class="col-4 canvas-ignore"></div>
                    <div class="col-4" style="margin-top: 60vh; height: 18vh; pointer-events: none;">
                        <div class="h-100 d-flex flex-column justify-content-between" style="margin: 0 13%;">

                            <div class="selection-box-border bg-system-name canvas-ignore "
                                style="height: 45%; pointer-events: all;">
                                <div id="selectionText" class="text-center align-items-center mt-1">
                                    LOADING
                                </div>
                            </div>

                            <div class="text-center container m-0 p-0 canvas-ignore"
                                style="height: 51%; pointer-events: all;">

                                <div class="container">
                                    <div class="row">
                                        <button type="button"
                                            class="m-1 mb-0 col selection-button selection-box-border selection-box-disabled"
                                            data-bs-toggle="modal" data-bs-target="#RESTRICTED1">
                                            [RESTRICTED]
                                        </button>
                                        <button type="button"
                                            class="m-1 mb-0 col selection-button selection-box-border selection-box-disabled"
                                            data-bs-toggle="modal" data-bs-target="#RESTRICTED2">
                                            [RESTRICTED]
                                        </button>
                                        <div class="w-100 bg-black"></div>
                                        <div
                                            class="m-1 col selection-button selection-box-border selection-box-disabled">
                                            [RESTRICTED]
                                        </div>
                                        <div
                                            class="m-1 col selection-button selection-box-border selection-box-disabled">
                                            [RESTRICTED]
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="col-4" style="pointer-events: none;"></div>
                </div>

            </div>

        </div>
    </div>

    <script src="./lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./js/Map/Main.js"></script>
    <script src="./js/LayoutJS.js" asp-append-version="true"></script>

    <script type="module">
        import { instancedCylinders, instancedSpheres, instancedText, borderMeshes } from './js/Map/Main.js';

        window.isNumeric = (str) => {
            return !isNaN(str) && !isNaN(parseFloat(str));
        }

        window.enforceMinMax = (e) => {
            if (e.data !== null && !/^[0-9]$/.test(e.data)) {
                e.preventDefault(); // block non-numeric input
                return;
            }
            const el = e.target;
            if (el.value != "") {
                if (parseInt(el.value + e.data) < parseInt(el.min)) {
                    e.preventDefault();
                }
                if (parseInt(el.value + e.data) > parseInt(el.max)) {
                    e.preventDefault();
                }
            }
        }

        window.clearValue = (id) => {
            const el = document.getElementById(id);
            el.value = '';
            el.dispatchEvent(new Event('input', { bubbles: true, cancelable: true }));
        }

        // Save checkbox state to localStorage
        function saveCheckboxState(checkboxId) {
            const checkbox = document.getElementById(checkboxId);
            localStorage.setItem(checkboxId, checkbox.checked);
        }

        // Load checkbox state from localStorage
        function loadCheckboxState(checkboxId) {
            const checkbox = document.getElementById(checkboxId);
            const savedState = localStorage.getItem(checkboxId);
            if (savedState !== null) {
                checkbox.checked = savedState === 'true';
                // Trigger the associated visibility function
                if (checkboxId === 'CBSystems') {
                    flipSystemVisibility(checkbox);
                } else if (checkboxId === 'CBLinks') {
                    flipLinkVisibility(checkbox);
                } else if (checkboxId === 'CBSystemNames') {
                    flipTextVisibility(checkbox);
                } else if (checkboxId === 'CBFactionBorders') {
                    flipBorderVisibility(checkbox);
                }
            }
        }

        // Update the onclick handlers to save state
        document.getElementById('CBSystems').onclick = function () {
            flipSystemVisibility(this);
            saveCheckboxState('CBSystems');
        };

        document.getElementById('CBLinks').onclick = function () {
            flipLinkVisibility(this);
            saveCheckboxState('CBLinks');
        };

        document.getElementById('CBSystemNames').onclick = function () {
            flipTextVisibility(this);
            saveCheckboxState('CBSystemNames');
        };

        document.getElementById('CBFactionBorders').onclick = function () {
            flipBorderVisibility(this);
            saveCheckboxState('CBFactionBorders');
        };

        // Load checkbox states when the page loads
        document.addEventListener('DOMContentLoaded', async function () {
            while (instancedCylinders == null || instancedSpheres == null || instancedText == null || borderMeshes == null) {
                await new Promise(r => setTimeout(r, 500));
            }

            loadCheckboxState('CBSystems');
            loadCheckboxState('CBLinks');
            loadCheckboxState('CBSystemNames');
            loadCheckboxState('CBFactionBorders')
        });

        window.flipSystemVisibility = (el) => {
            instancedSpheres.visible = el.checked;
        }

        window.flipLinkVisibility = (el) => {
            instancedCylinders.visible = el.checked;
        }

        window.flipTextVisibility = (el) => {
            instancedText.visible = el.checked;
        }

        window.flipBorderVisibility = (el) => {
            borderMeshes.forEach((borderMesh) => {
                borderMesh.visible = el.checked;
            });
        }

        function saveRadioButtonState() {
            const checkedRadio = document.querySelector('input[name="StarColoring"]:checked');
            if (checkedRadio) {
                localStorage.setItem('StarColoring', checkedRadio.id);
            }
        }


        function setupRadioButtonEvents() {
            const radioButtons = document.querySelectorAll('input[name="StarColoring"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function () {
                    saveRadioButtonState();
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Assuming sectors and links are available in the global scope or passed appropriately
            setupRadioButtonEvents();
        });
    </script>

</body>

</html>